<html>
  <head>
    <title>Detail</title>
  </head>
  <body onload="init()">
    <h1><a href='/'>Detail</a></h1>
    <input type='text' id="transport_name" value='{{ t_name }}'></input>
    <p></p>
    {{path}}
    <ul id="stops_list">
      {% for stop in stops %}
      <li>{{stop}}</li>
      {% endfor %}
    </ul>
    <textarea id="times"></textarea>
    <address>
      <a href="mailto:rasztasd@rasztasd-laptop">rasztasd</a>
    </address>
    <input type='button' id='detail_publish' value='Publish'></input>
    <div id="map_canvas" style="width:1000; height:500"></div>
    <canvas id="transport_canvas" style="position: relative; width: 1000; height: 500; top: -500px;">
      <p>Nem megy a canvas</p>
    </canvas>
    <!--canvas id="transport_canvas" style="position: relative; width: 1000px; height:500px">
      <p>Nem megy a canvas</p>     
    </canvas-->
    <script src="static/javascript/json2.js">
    </script>
    <script type="text/javascript"
	    src="http://maps.google.com/maps/api/js?sensor=false">
    </script>
    <!--script type="text/javascript"
	    src="/static/javascript/maps.js">
    </script-->
    <script src="http://code.jquery.com/jquery-1.4.3.js">
    </script>
    <script src="/static/javascript/detail.js">
    </script>
    <script>
    var ctx;
    //list of [x, y, Times in seconds] for stations
    var listOfPointsToVisitWithTimes = [[19, 37, 5], [22,48, 5], [20, 50, 5], [14.5, 46, 5]];
    function initCanvas() {
      //Millis
      canvas = document.getElementById('transport_canvas');
      var timeFrame = 10;
      var canvasWidth = canvas.offsetWidth;
      var canvasHeight = canvas.offsetHeight;
      var dotImage = new Image();
      dotImage.src = '/static/images/dot.png';
      dotImage.onload = function() {
	ctx = canvas.getContext('2d');
	setInterval(draw, timeFrame);
	var currentTime = 0;
	//station where we are hading to
	var currentStation = 1;
	//station where we are coming from
	var previousStation = 0;
	currentStepToStation = 0;
	function draw() {
	  try {
	    if (!map) {
	      return;
	    }
	    if (map.getBounds() == undefined) {
	      return;
	    }
	    bounds = map.getBounds();
	    southWest = bounds.getSouthWest();
	    northEast = bounds.getNorthEast();
	    lngSpan = northEast.lng() - southWest.lng();
	    latSpan = northEast.lat() - southWest.lat();
	    timeToReachNextStop = listOfPointsToVisitWithTimes[currentStation][2];
	    //in timeframes
	    timeframesToReachNextStop = (timeToReachNextStop * 1000) / timeFrame;
	    currentTime += timeFrame;
	    currentStepToStation += 1;
	    //We have reached the next stop
	    if ((timeToReachNextStop * 1000) == currentTime) {
	      previousStation = currentStation;
	      currentStation = currentStation + 1;
	      currentTime = 0;
	      currentStepToStation = 0;
	      if (currentStation > listOfPointsToVisitWithTimes.length - 1) {
		currentStation = 0;
	      }
	    }
	    previousStationX = listOfPointsToVisitWithTimes[previousStation][0];
	    previousStationY = listOfPointsToVisitWithTimes[previousStation][1];
	    nextStationX = listOfPointsToVisitWithTimes[currentStation][0];
	    nextStationY = listOfPointsToVisitWithTimes[currentStation][1];

	    x = (previousStationX + (((nextStationX - previousStationX) / timeframesToReachNextStop) * currentStepToStation));
	    y = (previousStationY + (((nextStationY - previousStationY) / timeframesToReachNextStop) * currentStepToStation));
	    ctx.clearRect(0, 0, canvasWidth, canvasHeight); // clear canvas    
	    if ((x > southWest.lng()) && (x < northEast.lng()) && (y > southWest.lat()) && (y < northEast.lat())) {
	      //longitude = x in descartes
	      //latitude = y
	      xToDraw = ((Math.abs(x - southWest.lng())) / lngSpan) * canvasWidth;
	      yToDraw = canvasHeight - (((Math.abs(y - southWest.lat())) / latSpan) * canvasHeight);
/*
	      ctx.strokeStyle = "#000000";
	      ctx.fillStyle = "#FFFF00";
	      ctx.beginPath();
*/
	      //ctx.drawImage(dotImage, (xToDraw/canvasWidth)*100, (yToDraw/canvasHeight)*100, 3, 3);
	      ctx.drawImage(dotImage, (xToDraw/canvasWidth)*100, (yToDraw/canvasHeight)*100, 3, 3);
	      ctx.drawImage(dotImage, xToDraw, yToDraw, 2, 2);
	      ctx.drawImage(dotImage, 10, 10, 2, 2);
	      /*
	      for (i = 0; i< 3; i++) {
		ctx.fillRect(i, i, 20, 20);
	      }
	      
	      //ctx.fillRect(10,10, 20, 20);
	      ctx.closePath();
	      ctx.stroke();
	      ctx.fill();
	      */
	    }

	  } catch(e) {
	    alert(e);
	  }
	}
      }
    }
    initCanvas();</script>
  </body>
</html>
